"use strict";var app=angular.module("clientApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ui.router","ngSanitize","ngTouch"]);app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("main",{"abstract":!0,templateUrl:"views/main.html",data:{requireLogin:!1}}).state("main.homepage",{url:"/",controller:"MainCtrl",views:{landing:{templateUrl:"views/homepage/landing.html"},pilotProcess:{templateUrl:"views/homepage/pilotProcess.html",controller:"ProcessCtrl"},pilots:{templateUrl:"views/homepage/pilots.html",controller:"PilotsCtrl"},layerIntro:{templateUrl:"views/homepage/layerIntro.html"},contact:{templateUrl:"views/homepage/contact.html"}}}).state("about",{url:"/about",templateUrl:"views/about.html",controller:"AboutCtrl",data:{requireLogin:!1}}).state("signup",{url:"/signup",templateUrl:"views/signup.html",controller:"SignupCtrl",data:{requireLogin:!1}}).state("app",{"abstract":!0,url:"#",data:{requireLogin:!1}}).state("dashboard",{url:"/dashboard",templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).state("compass",{url:"/compass",templateUrl:"views/compass.html",controller:"CompassCtrl"}).state("city",{templateUrl:"views/cities/cityDefault.html",controller:"CitiesCtrl"}).state("city.pilot",{url:"/dashboard/:city_name",views:{mapModal:{templateUrl:"views/cities/mapmodal.html",controller:"MapModalCtrl"}}})}]),angular.module("clientApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("clientApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("clientApp").controller("SignupCtrl",["$scope","$location","$http",function(a,b,c){var d,e;a.signup=e={},e.user=d={},e.submit=function(){if(!(d.username&&d.email&&d.password1&&d.password2))return window.alert("Please fill out all fields."),!1;if(d.password1!==d.password2)return window.alert("Your passwords must match."),!1;var a=c.post("/signup",d);a.success(function(a){b.path("/dashboard"),console.log(a)}),a.error(function(a){console.log("error"),console.log(a)})},a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("clientApp").controller("DashboardCtrl",["$scope","$location","$stateParams",function(a,b,c){a.addMap=function(){var b=window.L;b.mapbox.accessToken="pk.eyJ1IjoidXJiaW5zaWdodCIsImEiOiJIbG1xUDBBIn0.o2RgJkl1-wCO7yyG7Khlzg",a.map=b.mapbox.map("dashboardMap","urbinsight.l906cd2j",{zoomControl:!0,minZoom:3}).setView([0,0],3)},a.addMap(),a.$stateParams=c,a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("clientApp").controller("ProcessCtrl",["$scope",function(a){a.addMap=function(){var a=window.L;a.mapbox.accessToken="pk.eyJ1IjoidXJiaW5zaWdodCIsImEiOiJIbG1xUDBBIn0.o2RgJkl1-wCO7yyG7Khlzg";var b=a.mapbox.map("pilotProcessMap","urbinsight.jh7lje5c",{zoomControl:!1}).setView([0,0],2);b.touchZoom.disable(),b.doubleClickZoom.disable(),b.scrollWheelZoom.disable()},a.addMap(),a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("clientApp").controller("PilotsCtrl",["$scope",function(a){a.imgLoader=function(){window.$(document).ready(function(){window.$("#medellin").hover(function(){window.$(this).removeClass("darken")},function(){window.$(this).addClass("darken")}),window.$("#cairo").hover(function(){window.$(this).removeClass("darken")},function(){window.$(this).addClass("darken")}),window.$("#casablanca").hover(function(){window.$(this).removeClass("darken")},function(){window.$(this).addClass("darken")})})},a.imgLoader(),a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("clientApp").controller("CitiesCtrl",["$scope","$location","$http",function(a,b,c){a.$cities={vancouver:{lat:"49.2496600",lon:"-123.1193400",layers:{"Water Mains":"urbinsight.vanWaterNetwork",Sources:"urbinsight.vancouverwatersources",Upstream:"urbinsight.vanupstream",Parcels:"urbinsight.qmfmkj4i",Downstream:"urbinsight.vandownstream",Sinks:"urbinsight.larr7ldi"}},medellin:{lat:"6.2491",lon:"-75.5891",layers:{"Quality of Life":"thissaysnothing.y3cy2e29","Geological Classification":"thissaysnothing.Layers","Heart Disease per 100,000":"thissaysnothing.pjznz5mi","Youth Population Change":"thissaysnothing.youth_population","Youth Population Nominal":"thissaysnothing.8w06yldi","Nominal Senior Population":"thissaysnothing.senior_population","Water System":"thissaysnothing.water_system","Structural Axes of Public Spaces":"thissaysnothing.46q7iudi","Green Infrastructure":"thissaysnothing.5i0e8kt9"}},cairo:{lat:"30.0600",lon:"31.2333",layers:{"Water Quality":"urbinsight.cairowaterquality","Parcel Audit":"urbinsight.cairoparcelaudit","Air Quality":"urbinsight.cairoairquality","Unemployment Rate":"urbinsight.cairolaborpop","Marital Rate":"urbinsight.cairomaritalpopulation","School Enrollment Rate":"urbinsight.cairoschoolpop","Youth Population Percentage":"urbinsight.youthpopforcairo","Total Population":"urbinsight.cairototalpopulation"}},casablanca:{lat:"33.5333",lon:"-7.5833"},lima:{lat:"-12.0433",lon:"-77.0283"}},a.$colors={source:"#9c89cc",upstream:"#7ec9b1",demand:"#3ca0d3",downstream:"#fa946e",sink:"#f1f075"};var d;a.L=d=window.L;var e,f=b.path().split("/")[2];a.$city=e=a.$cities[f],a.renderMap=function(){console.log("rendering"),d.mapbox.accessToken="pk.eyJ1IjoidXJiaW5zaWdodCIsImEiOiJIbG1xUDBBIn0.o2RgJkl1-wCO7yyG7Khlzg",a.map=d.mapbox.map("cityMap",{zoomControl:!0,minZoom:3}).setView([e.lat,e.lon],12);var b=!0,c={};angular.forEach(e.layers,function(e,f){if(b){c[f]=d.mapbox.tileLayer(e).addTo(a.map);var g=d.mapbox.gridLayer(e);a.map.addLayer(g),a.map.addControl(d.mapbox.gridControl(g)),b=!1}else{c[f]=d.mapbox.tileLayer(e);var g=d.mapbox.gridLayer(e);a.map.addLayer(g),a.map.addControl(d.mapbox.gridControl(g))}}),d.control.layers({"Base Map":d.mapbox.tileLayer("urbinsight.150c04d2").addTo(a.map),"Satellite Map":d.mapbox.tileLayer("urbinsight.l906cd2j"),"Toner Map":d.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'}),"Watercolor Map":d.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'})},c).addTo(a.map)},a.renderMap(),a.fetchNodes=function(){var b=c.get("/data/label/"+f),d=a;b.success(function(a){angular.forEach(a,function(a,b){angular.forEach(a,function(a){var c=parseFloat(a.lat),e=parseFloat(a.lng);d.L.marker([c,e],{icon:d.L.mapbox.marker.icon({"marker-size":"small","marker-color":d.$colors[b]})}).bindPopup("<p>Type: "+b+"</p><p>Id: "+a.id+"</p>").addTo(d.map).on("click",function(){d.drawFlows(a)})})})})},a.fetchNodes(),a.linesAdded=[],a.drawFlows=function(b){var e=c.get("/data/relation/"+b.id),f=a;e.success(function(a){angular.forEach(f.linesAdded,function(a){f.map.removeLayer(a)}),angular.forEach(a,function(a){f.linesAdded.push(d.polyline(a,{color:"teal",opacity:1,weight:10}).addTo(f.map))})}),e.error(function(){})},a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("clientApp").controller("CompassCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("clientApp").controller("MapModalCtrl",["$scope",function(a){$("#plusclick").on("click",function(){$("#mapModal").toggleClass("hoveredon"),$("#modalbar").toggleClass("shown")}),a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);